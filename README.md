# Выпускная квалификационная работа (диплом)
**Группа:** МКБ 241 Кибербезопасность (магистратура)  
**Дата выполнения:** 08.01.2026 

## Тема
**Применение методов машинного обучения для обнаружения аномалий в активности пользователей на событиях службы каталогов и данных сетевого трафика.**

## Цель работы
Создать программный прототип, который принимает выгрузки SIEM, нормализует события,
формирует признаковое описание активности пользователей и хостов, обучает модели
поиска аномалий и предоставляет аналитические отчёты в виде таблиц и графиков.

## Задачи
1. Подготовить конвейер нормализации исходных SIEM-выгрузок.
2. Построить набор числовых признаков по пользователям/хостам на ежедневной основе.
3. Реализовать обучение и скоринг моделей обнаружения аномалий.
4. Обеспечить интерпретацию причин аномалий (топ факторов отклонения).
5. Сформировать визуальные отчёты за сутки, неделю и месяц.

## Структура проекта
```
/README.md                 — основное описание работы
/script/                   — скрипты обработки данных и анализа
/script/readme.md           — подробная документация по каждому скрипту
/script/data/               — входные выгрузки SIEM (TSV/TXT)
/script/work/               — рабочие результаты и промежуточные данные
/script/features/           — признаки, аномалии и объяснения
/script/report/             — итоговые отчёты и графики
/screens/                  — скриншоты и иллюстрации к отчётам
```

## Краткий конвейер обработки
1. **Нормализация SIEM** (`python_script.py`) → суточные CSV + анонимизация пользователей (в `work`).
2. **Построение признаков** (`build_features_v2.py`) → `features_users.csv`, `features_hosts.csv` (в `features`).
3. **Очистка признаков** (`preprocess_features.py`) → `features_*_clean.csv` (в `features`).
4. **Обучение и скоринг** (`train_anomaly_models.py`) → топ аномалий по дате (в `features`).
5. **Объяснение аномалий** (`explain_anomalies.py`) → топ признаков отклонения (в `features`).
6. **Визуализация** (`visualize_reports.py` / `auto_generate_reports.py`) → графики (в `report`).
7. **SOC-отчёт** (`soc_report.py`) → Markdown-отчёт с контекстом (в `report`, имя содержит дату/время).

## Алгоритм и последовательность запуска
Ниже приведена типовая последовательность, которую можно использовать как «шпаргалку»:
1. Нормализовать выгрузки SIEM и получить суточные CSV.
2. Построить признаки по пользователям и хостам.
3. Очистить признаки (удаление пропусков, приведение типов).
4. Обучить модели аномалий и получить список аномалий за выбранные даты.
5. Сформировать объяснения (человеко-читаемые причины).
6. Построить визуальные отчёты.
7. Сформировать SOC-отчёт с контекстом (действия, ПО, события, сеть, аномальное время).

## Быстрый старт (пример)
```bash
cd script
python python_script.py
python build_features_v2.py --work ./work --features-dir ./features
python preprocess_features.py --work ./features
python train_anomaly_models.py --work ./features
python explain_anomalies.py --work ./features
python visualize_reports.py --work ./features --scope day --top-pct 0.05
python soc_report.py --work ./work --features-dir ./features --scope day
```

## Примеры запуска отчётов по периоду
### За конкретный день
```bash
cd script
python soc_report.py --work ./work --features-dir ./features --scope day --date 2025-12-31
```

### За конкретную неделю (7 дней до указанной даты включительно)
```bash
cd script
python soc_report.py --work ./work --features-dir ./features --scope week --date 2025-12-31
```

### За конкретный месяц (30 дней до указанной даты включительно)
```bash
cd script
python soc_report.py --work ./work --features-dir ./features --scope month --date 2025-12-31
```

## Зависимости
- Python 3.10+
- pandas
- numpy
- scikit-learn
- matplotlib

Установка:
```bash
pip install -U pandas numpy scikit-learn matplotlib
```

## Данные на yandex disk
- данные по пользователям, хостам и логи с NGFW Palo Alto <a href="https://disk.360.yandex.ru/d/tDWSEVv5PEz9gQ">(ссылка на yandex disk)</a>
- данные взяты с SIEM KUMA (Kaspersky)
- данные необходимо обезличить перед исполтзованием с помощью python_script.py (переименует всех пользователей в userXXX)


## Результаты работы
- Таблицы аномалий для пользователей и хостов.
- Объяснения ключевых факторов отклонения.
- Рекомендации для аналитика SOC по причинам аномалий.
- Визуальные отчёты (гистограммы, тренды, распределение серьёзности).

## Автор и научный руководитель
**Автор:** В. С. Новиков  
**Научный руководитель** Д. В. Смирнов
